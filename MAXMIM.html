<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>מחשבון מדידות (מתוקן)</title>
  <style>
    :root{ --bg:#0b0f14; --card:#1e293b; --text:#f1f5f9; --muted:#94a3b8; --accent:#3b82f6; --green:#22c55e; --red:#ef4444; --font:system-ui,sans-serif; }
    *{ box-sizing:border-box; -webkit-tap-highlight-color:transparent; }
    body{ margin:0; background:var(--bg); color:var(--text); font-family:var(--font); padding:10px; }
    .wrap{ max-width:600px; margin:0 auto; display:flex; flex-direction:column; gap:12px; }
    
    .card{ background:var(--card); padding:16px; border-radius:12px; border:1px solid rgba(255,255,255,0.08); }
    
    /* תוצאות */
    .results{ display:grid; grid-template-columns:1fr 1fr; gap:10px; text-align:center; }
    .res-box{ background:rgba(0,0,0,0.2); padding:10px; border-radius:8px; }
    .label{ font-size:12px; color:var(--muted); display:block; margin-bottom:4px; }
    .val{ font-size:26px; font-weight:800; font-family:monospace; direction:ltr; }
    .min{ color:var(--green); } .max{ color:var(--red); }
    
    /* סטטוס */
    .status{ display:flex; justify-content:space-between; font-size:13px; color:var(--muted); margin-top:8px; padding-top:8px; border-top:1px solid rgba(255,255,255,0.05); }
    
    /* קלט */
    textarea{ width:100%; height:100px; background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1); color:#fff; padding:10px; border-radius:8px; font-size:16px; font-family:monospace; margin:10px 0; outline:none; }
    textarea:focus{ border-color:var(--accent); }
    
    .controls{ display:flex; gap:10px; margin-bottom:10px; }
    input{ background:rgba(0,0,0,0.3); border:1px solid rgba(255,255,255,0.1); color:#fff; padding:8px; border-radius:6px; text-align:center; width:100%; }

    button{ width:100%; padding:14px; background:var(--accent); border:none; color:white; font-weight:bold; border-radius:8px; font-size:16px; cursor:pointer; }
    button:active{ opacity:0.9; transform:scale(0.98); }
    .clear{ background:rgba(255,255,255,0.1); margin-top:10px; }

    /* טבלה */
    .table-con{ max-height:250px; overflow-y:auto; margin-top:10px; border-radius:8px; border:1px solid rgba(255,255,255,0.05); }
    table{ width:100%; border-collapse:collapse; font-size:14px; }
    td{ padding:8px; border-bottom:1px solid rgba(255,255,255,0.05); text-align:left; }
    td.num{ font-family:monospace; direction:ltr; text-align:right; }
    tr.is-min td{ color:var(--green); font-weight:bold; }
    tr.is-max td{ color:var(--red); font-weight:bold; }
  </style>
</head>
<body>

<div class="wrap">
  <div class="card">
    <div class="results">
      <div class="res-box">
        <span class="label">MIN (נמוך)</span>
        <span class="val min" id="minVal">-</span>
      </div>
      <div class="res-box">
        <span class="label">MAX (גבוה)</span>
        <span class="val max" id="maxVal">-</span>
      </div>
    </div>
    <div class="status">
      <span>כמות: <strong id="count">0</strong></span>
      <span>דלתא: <strong id="delta">-</strong></span>
    </div>
  </div>

  <div class="card">
    <div class="controls">
      <div><span class="label">דיוק</span><input type="number" id="dec" value="3"></div>
      <div><span class="label">יחידות</span><input type="text" id="unit" value='מ"מ'></div>
    </div>
    <span class="label">הדבק נתונים (תומך במינוס בסוף 0.050-)</span>
    <textarea id="input" placeholder="5.043 5.025 0.050-"></textarea>
    <button onclick="calc()">חשב</button>
    <button class="clear" onclick="cls()">נקה</button>
  </div>

  <div class="card">
    <span class="label">פירוט מדידות:</span>
    <div class="table-con">
      <table id="tbl"></table>
    </div>
  </div>
</div>

<script>
const el = i => document.getElementById(i);

function calc() {
  let raw = el('input').value;
  
  // 1. תיקון מינוס בסוף (למשל 0.050- הופך ל -0.050)
  // מחליף כל מספר שמסתיים במינוס להיות עם מינוס בהתחלה
  raw = raw.replace(/(\d+(\.\d+)?)-/g, "-$1");

  // 2. פירוק לפי כל רווח או ירידת שורה
  // הביטוי הרגולרי מחפש מספרים (חיוביים או שליליים)
  let matches = raw.match(/-?\d+(\.\d+)?/g);

  if (!matches) return cls(true);

  // המרה למספרים אמיתיים
  let nums = matches.map(Number);
  
  let min = Math.min(...nums);
  let max = Math.max(...nums);
  let dec = parseInt(el('dec').value) || 3;
  let unit = el('unit').value;

  // הצגת תוצאות
  el('minVal').innerText = min.toFixed(dec);
  el('maxVal').innerText = max.toFixed(dec);
  el('count').innerText = nums.length;
  el('delta').innerText = (max - min).toFixed(dec);

  // בניית טבלה
  let html = '';
  nums.forEach((n, i) => {
    let cls = '';
    let mark = '';
    if (n === min) { cls = 'is-min'; mark = 'MIN'; }
    if (n === max) { cls = 'is-max'; mark = 'MAX'; }
    
    html += `<tr class="${cls}">
      <td style="width:30px; color:#666;">${i+1}</td>
      <td class="num">${n.toFixed(dec)} ${unit}</td>
      <td style="font-size:11px;">${mark}</td>
    </tr>`;
  });
  el('tbl').innerHTML = html;
  
  // סידור מחדש של הקלט שיראה יפה
  el('input').value = nums.join('  '); 
}

function cls(keepText = false) {
  if(!keepText) el('input').value = '';
  el('minVal').innerText = '-';
  el('maxVal').innerText = '-';
  el('count').innerText = '0';
  el('delta').innerText = '-';
  el('tbl').innerHTML = '';
}
</script>
</body>
</html>
